<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Icon to PNG</title>
    <style>
        @font-face {
            font-family: "MyFont";
            src: url("icon.ttf") format('truetype');
        }
    </style>
</head>

<body>
    <!-- 这个用于验证字体是否生效 -->
    <div style="font-size: 100px;">&#xE64C;</div>

    <canvas id="iconCanvas" width="256" height="256"></canvas>
    <button id="downloadBtn">Download as PNG</button>

    <script>
        // ✅ 关键：显式加载字体
        const font = new FontFace("MyFont", "url(icon.ttf)");

        font.load().then(() => {
            // 字体加载成功，注册到文档
            document.fonts.add(font);

            // ✅ 现在才安全地绘制到 Canvas
            drawIcon();
        }).catch(err => {
            alert("字体加载失败: " + err);
        });

        function drawIcon() {
            const canvas = document.getElementById('iconCanvas');
            const ctx = canvas.getContext('2d');

            // 清空（确保透明）
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 设置字体（现在 MyFont 已可用）
            ctx.font = '240px MyFont';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = 'black';
            ctx.shadowColor = 'rgb(22, 221, 221)';
            ctx.shadowBlur = 25.6;

            // ✅ 使用 \uE64C（正确！）
            ctx.fillText('\uE6A6', 128, 128);
        }

        document.getElementById('downloadBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'icon.png';
            link.href = document.getElementById('iconCanvas').toDataURL('image/png');
            link.click();
        });
    </script>
</body>

</html>
